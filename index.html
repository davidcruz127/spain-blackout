<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spain Blackout</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
</head>
<body>
  <div id="intro">‚ö° Spain Blackout ‚ö°</div>

  <!-- Men√∫ de inicio -->
  <div id="menu" class="panel">
    <img id="menuImage" src="./img/blackout_background.png" alt="Decoraci√≥n Blackout" />
    <h1>‚ö° Spain Blackout ‚ö°</h1>
    <p class="subtitle">Gestiona la energ√≠a. Evita el colapso.</p>
    <button id="startButton">üöÄ Comenzar</button>
  </div>

  <!-- Pantalla de toque para iniciar -->
  <div id="tapToStart">‚ö° Pulsa la pantalla para comenzar ‚ö°</div>

  <!-- Pantalla de fin de juego -->
  <div id="gameOver" class="panel" style="display:none;">
    <h1 id="gameOverMessage">üîå Apag√≥n total üîå</h1>
    <h2 id="finalScore">Puntuaci√≥n: 0</h2>
    <div id="ranking"><strong>Top 5:</strong><br /></div>
    <button id="retryButton">üîÑ Reintentar</button>
  </div>

  <!-- Marcadores -->
  <div id="scoreDisplay">Puntos: 0</div>
  <div id="warning">‚ö†Ô∏è Alerta</div>

  <div id="legend">
    <div><span class="legend-icon" style="color:#ff00ff;">‚ö°</span> Producci√≥n</div>
    <div><span class="legend-icon" style="color:#00ffff;">üí°</span> Consumo</div>
  </div>

  <!-- Canvas -->
  <canvas id="gameCanvas"></canvas>

  <!-- Sonidos -->
  <audio id="jumpSound" src="sounds/jump.mp3"></audio>
  <audio id="hitOvervoltage" src="sounds/overvoltage.mp3"></audio>
  <audio id="hitBlackout" src="sounds/blackout.mp3"></audio>
  <audio id="chargeSound" src="sounds/charge.mp3"></audio>
  <audio id="endGameSound" src="sounds/end.mp3"></audio>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <!-- Detectar entorno y cargar configuraci√≥n -->
  <script>
    const loadConfig = () => {
      return new Promise((resolve) => {
        const script = document.createElement('script');
        // Si estamos en localhost, cargamos config.js (privado). Si no, config.prod.js
        script.src = location.hostname === "localhost" ? "config.js" : "config.prod.js";
        script.onload = () => resolve();
        script.onerror = () => {
          console.warn("Archivo de configuraci√≥n no encontrado.");
          window.CONFIG = {
            FIREBASE_API_KEY: "",
            GOOGLE_ANALYTICS_ID: ""
          };
          resolve();
        };
        document.head.appendChild(script);
      });
    };

    loadConfig().then(() => {
      // Google Analytics
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      if (CONFIG.GOOGLE_ANALYTICS_ID) {
        gtag('config', CONFIG.GOOGLE_ANALYTICS_ID);
      }

      // Inicializar Firebase
      if (CONFIG.FIREBASE_API_KEY) {
        const firebaseConfig = {
          apiKey: CONFIG.FIREBASE_API_KEY,
          authDomain: "spain-blackout.firebaseapp.com",
          databaseURL: "https://spain-blackout-default-rtdb.firebaseio.com",
          projectId: "spain-blackout",
          storageBucket: "spain-blackout.appspot.com",
          messagingSenderId: "122354187288",
          appId: "1:122354187288:web:2c9c57ee5b6b5b972ad76d"
        };

        firebase.initializeApp(firebaseConfig);
        window.db = firebase.database();
      } else {
        console.warn("Firebase no inicializado: falta clave API.");
      }

      // Cargar el juego
      const mainScript = document.createElement('script');
      mainScript.src = "main.js";
      document.body.appendChild(mainScript);
    });
  </script>

</body>
</html>
